<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Installation Test - Ngrok Environment</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .code { background-color: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; }
        ol li { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>PWA Installation Test Guide - Ngrok Environment</h1>
    
    <div class="section warning">
        <h2>üîß Recent Changes Made</h2>
        <ul>
            <li><strong>Dynamic Manifest:</strong> Created utility to generate manifest with correct domain URLs</li>
            <li><strong>Ngrok Headers:</strong> Added ngrok-skip-browser-warning meta tag and headers</li>
            <li><strong>Service Worker:</strong> Enhanced service worker registration for ngrok environment</li>
            <li><strong>Vite Config:</strong> Updated server configuration for ngrok compatibility</li>
        </ul>
    </div>

    <div class="section">
        <h2>üì± Testing PWA Installation on Ngrok</h2>
        <h3>Step 1: Access via Ngrok URL</h3>
        <ol>
            <li>Open <code>https://397d1c0f105f.ngrok-free.app</code> in Chrome mobile or desktop</li>
            <li>If you see ngrok warning page, click "Visit Site" (the meta tag should skip this)</li>
            <li>Wait for the app to fully load</li>
        </ol>

        <h3>Step 2: Check PWA Criteria</h3>
        <ol>
            <li>Open Chrome DevTools (F12)</li>
            <li>Go to Application tab ‚Üí Manifest</li>
            <li>Verify manifest loads correctly with ngrok URLs</li>
            <li>Check Service Workers tab - should show registered worker</li>
            <li>Look for any console errors related to PWA</li>
        </ol>

        <h3>Step 3: Test Installation Methods</h3>
        <ol>
            <li><strong>Browser Menu:</strong> Look for "Install app" in Chrome menu (‚ãÆ)</li>
            <li><strong>Address Bar:</strong> Look for install icon in address bar</li>
            <li><strong>Custom Button:</strong> Go to Me page, click "Install App" button</li>
        </ol>
    </div>

    <div class="section">
        <h2>üêõ Troubleshooting Ngrok PWA Issues</h2>
        
        <h3>Common Issues & Solutions:</h3>
        
        <h4>1. "Install App" option not appearing in browser menu</h4>
        <ul>
            <li>Ensure you're using HTTPS (ngrok provides this automatically)</li>
            <li>Check if service worker is registered in DevTools</li>
            <li>Verify manifest.json loads without errors</li>
            <li>Clear browser cache and reload</li>
        </ul>

        <h4>2. beforeinstallprompt event not firing</h4>
        <ul>
            <li>Check console for PWA-related logs</li>
            <li>Ensure app meets all PWA criteria</li>
            <li>Try in incognito mode</li>
            <li>Test on different devices/browsers</li>
        </ul>

        <h4>3. Ngrok warning page interfering</h4>
        <ul>
            <li>The app now includes ngrok-skip-browser-warning header</li>
            <li>If still seeing warning, manually click "Visit Site"</li>
            <li>Consider upgrading to paid ngrok plan</li>
        </ul>

        <h4>4. Service worker not registering</h4>
        <ul>
            <li>Check Network tab for service worker requests</li>
            <li>Verify VitePWA plugin is working correctly</li>
            <li>Look for CORS or security policy errors</li>
        </ul>
    </div>

    <div class="section success">
        <h2>‚úÖ Expected Behavior</h2>
        <ul>
            <li><strong>On Mobile Chrome:</strong> "Install app" appears in browser menu</li>
            <li><strong>On Desktop Chrome:</strong> Install icon appears in address bar</li>
            <li><strong>Custom Button:</strong> "Install App" button triggers native prompt</li>
            <li><strong>After Install:</strong> App opens in standalone mode</li>
            <li><strong>Offline:</strong> App works without internet connection</li>
        </ul>
    </div>

    <div class="section">
        <h2>üîç Debug Console Commands</h2>
        <p>Run these in browser console to debug:</p>
        <div class="code">
// Check if running on ngrok<br>
console.log('Domain:', window.location.hostname);<br>
console.log('Is Ngrok:', window.location.hostname.includes('ngrok-free.app'));<br><br>
// Check service worker<br>
navigator.serviceWorker.getRegistrations().then(regs => console.log('SW Registrations:', regs));<br><br>
// Check manifest<br>
fetch('/manifest.json').then(r => r.json()).then(m => console.log('Manifest:', m));<br><br>
// Check PWA criteria<br>
console.log('HTTPS:', location.protocol === 'https:');<br>
console.log('Service Worker Support:', 'serviceWorker' in navigator);<br>
console.log('Standalone Mode:', window.matchMedia('(display-mode: standalone)').matches);
        </div>
    </div>

    <div class="section error">
        <h2>üö® If Still Not Working</h2>
        <ol>
            <li>Try different browsers (Chrome, Edge, Firefox)</li>
            <li>Test on actual mobile device vs desktop simulation</li>
            <li>Check if ngrok tunnel is stable and not expired</li>
            <li>Verify all PWA assets (icons, manifest) are accessible via ngrok URL</li>
            <li>Consider testing with a different ngrok tunnel URL</li>
        </ol>
    </div>

    <div class="section">
        <h2>üìã Test Checklist</h2>
        <ul>
            <li>‚ñ° App loads correctly on ngrok URL</li>
            <li>‚ñ° No console errors related to PWA</li>
            <li>‚ñ° Service worker registers successfully</li>
            <li>‚ñ° Manifest.json loads with correct ngrok URLs</li>
            <li>‚ñ° "Install app" appears in browser menu</li>
            <li>‚ñ° Custom "Install App" button works</li>
            <li>‚ñ° App installs and opens in standalone mode</li>
            <li>‚ñ° App works offline after installation</li>
        </ul>
    </div>
</body>
</html>